# OFC游戏规则说明

## 1. 游戏概述

OFC（Omaha Five-Card）是一种五张牌扑克游戏变体，玩家需要将13张牌分成三部分：顶部3张，中部5张，底部5张。游戏的目标是让这三部分手牌的强度从顶部到底部依次递增，同时获得尽可能高的得分。

## 2. 基本规则

### 2.1 牌局流程

1. **发牌**：第一轮发5张牌，第2-5轮每轮发3张牌，总共发17张牌
2. **弃牌**：第2-4轮每轮丢弃一张牌，总共丢弃4张牌，剩余13张牌
3. **摆牌**：将13张牌分成三部分：顶部3张，中部5张，底部5张
4. **评估**：评估三部分手牌的强度，确保底部强度 >= 中部强度 >= 顶部强度
5. **计分**：根据各部分手牌的强度计算得分
6. **判定**：检查是否爆牌（违反强度顺序），爆牌者得分为0

### 2.2 区域限制

| 区域 | 牌数限制 | 强度要求 |
|------|---------|----------|
| 顶部 | 最多3张 | 最弱 |
| 中部 | 最多5张 | 中等 |
| 底部 | 最多5张 | 最强 |
| 临时 | 无限制 | 待摆放 |

## 3. 手牌评估

### 3.1 牌型强度顺序（从高到低）

#### 5张牌牌型（中部和底部）
1. 皇家同花顺（Royal Straight Flush）：A-K-Q-J-10同花色
2. 同花顺（Straight Flush）：五张连续同花色牌
3. 四条（Four of a Kind）：四张相同点数的牌
4. 葫芦（Full House）：三条+一对
5. 同花（Flush）：五张同花色牌
6. 顺子（Straight）：五张连续点数牌（包括A2345低顺）
7. 三条（Three of a Kind）：三张相同点数的牌
8. 两对（Two Pairs）：两对不同点数的牌
9. 一对（One Pair）：一对相同点数的牌
10. 高牌（High Card）：无牌型

#### 3张牌牌型（顶部）
1. 三条（Three of a Kind）：三张相同点数的牌
2. 一对（One Pair）：一对相同点数的牌
3. 高牌（High Card）：无牌型

### 3.2 特殊规则

- **轮子（Wheel）**：A2345是最小的顺子，但在评估时视为有效顺子
- **花色**：花色在评估牌型时不考虑，仅在牌型相同时作为平局决胜
- **点数**：点数大小顺序为：A > K > Q > J > 10 > 9 > 8 > 7 > 6 > 5 > 4 > 3 > 2

## 4. 计分规则

### 4.1 顶部区域得分

| 牌型 | 得分 |
|------|------|
| 高牌 | 0 |
| 一对 | 根据点数（见配置文件） |
| 三条 | 根据点数（见配置文件） |

### 4.2 中部和底部区域得分

| 牌型 | 得分 |
|------|------|
| 高牌 | 0 |
| 一对 | 1 |
| 两对 | 3 |
| 三条 | 6 |
| 顺子 | 10 |
| 同花 | 15 |
| 葫芦 | 25 |
| 四条 | 50 |
| 同花顺 | 100 |
| 皇家同花顺 | 150 |

### 4.3 幻想模式（Fantasy Land）

- **触发条件**：玩家在第一轮（5张牌）就形成了足够强的牌型
- **奖励**：进入幻想模式的玩家在最终得分时获得额外奖励（见配置文件）
- **特殊规则**：幻想模式下的发牌数量和游戏流程可能与普通模式不同

### 4.4 爆牌惩罚

- **爆牌条件**：违反强度顺序（顶部 > 中部 或 中部 > 底部）
- **惩罚**：爆牌者得分为0

## 5. 规则配置

游戏规则通过 `config/game_rules.yaml` 文件配置，支持以下配置项：

### 5.1 区域长度配置

```yaml
region_lengths:
  top: 3      # 顶部区域牌数
  middle: 5   # 中部区域牌数
  bottom: 5   # 底部区域牌数
```

### 5.2 计分配置

```yaml
scoring:
  top_win: 1            # 顶部区域获胜得分
  middle_win: 2         # 中部区域获胜得分
  bottom_win: 3         # 底部区域获胜得分
  fantasyland_bonus: 10 # 幻想模式奖励得分
```

### 5.3 顶部对子得分配置

```yaml
top_pair_scores:
  2: 1
  3: 1
  # ... 其他点数
  Q: 2
  K: 3
  A: 4
```

### 5.4 顶部三条得分配置

```yaml
top_trips_scores:
  2: 3
  3: 3
  # ... 其他点数
  Q: 6
  K: 9
  A: 12
```

### 5.5 MCTS配置

```yaml
mcts:
  exploration_weight: 1.0  # 探索权重
  simulation_count: 1000   # 模拟次数
  temperature: 1.0         # 温度参数
```

## 6. AI决策

### 6.1 策略接口

AI策略通过 `AIStrategy` 抽象类定义，包含以下方法：

- `decide_placement`：决定卡牌摆放
- `choose_action`：选择行动
- `evaluate_state`：评估状态

### 6.2 内置策略

#### 启发式策略（HeuristicStrategy）
- 基于简单规则和启发式评估
- 考虑区域牌数限制和强度要求
- 评估每个可能行动的得分

#### MCTS策略（MCTSStrategy）
- 基于蒙特卡洛树搜索
- 模拟多次游戏过程
- 选择最优行动

## 7. 日志与分析

### 7.1 日志记录

游戏过程中会记录以下信息：

- 游戏开始和结束时间
- 每轮游戏状态
- 玩家手牌状态
- AI决策过程
- 得分变化

### 7.2 统计分析

分析系统可以：

- 分析AI决策模式
- 分析手牌状态分布
- 分析得分变化趋势
- 生成统计报告和可视化图表
- 查找潜在的bug

## 8. 常见问题

### 8.1 爆牌判定

**问题**：为什么我的牌看起来很强但被判定为爆牌？

**原因**：爆牌判定基于区域强度顺序，不是基于绝对强度。即使你的顶部区域是一对A，如果你底部区域只是高牌，仍然会被判定为爆牌。

### 8.2 轮子顺子

**问题**：A2345是否被视为顺子？

**答案**：是的，A2345被视为有效的顺子（低顺）。

### 8.3 幻想模式

**问题**：如何进入幻想模式？

**答案**：在第一轮（5张牌）就形成足够强的牌型，具体条件见游戏规则配置。

### 8.4 得分计算

**问题**：为什么我的得分比预期低？

**原因**：得分计算基于各区域手牌的强度，不是基于绝对牌力。同时，爆牌会导致得分为0。

## 9. 术语表

| 术语 | 解释 |
|------|------|
| OFC | Omaha Five-Card，五张牌奥马哈扑克 |
| 爆牌 | 违反区域强度顺序，得分为0 |
| 幻想模式 | 特殊游戏模式，提供额外奖励 |
| 轮子 | A2345低顺 |
| MCTS | Monte Carlo Tree Search，蒙特卡洛树搜索 |
| 皇家同花顺 | A-K-Q-J-10同花色 |
| 同花顺 | 五张连续同花色牌 |
| 四条 | 四张相同点数的牌 |
| 葫芦 | 三条+一对 |
| 同花 | 五张同花色牌 |
| 顺子 | 五张连续点数牌 |
| 三条 | 三张相同点数的牌 |
| 两对 | 两对不同点数的牌 |
| 一对 | 一对相同点数的牌 |
| 高牌 | 无牌型 |
